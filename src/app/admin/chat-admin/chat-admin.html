<div class="min-h-screen bg-linear-to-br from-purple-50 to-indigo-50 py-8 px-4">
  <div class="max-w-5xl mx-auto">
    <h1 class="text-3xl font-bold text-purple-700 mb-6">Chat de Soporte - Admin</h1>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
      <!-- Lista de usuarios -->
      <div class="bg-white rounded-lg shadow-lg p-4 md:col-span-1">
        <div class="flex items-center justify-between mb-2">
          <h2 class="text-lg font-semibold">Usuarios</h2>
          <button (click)="nuevoChat()" class="bg-cyan-600 hover:bg-cyan-700 text-white px-3 py-1 rounded text-sm">Nuevo chat</button>
        </div>
        <input type="text" [(ngModel)]="terminoBusqueda" (ngModelChange)="cargarUsuarios(1)" placeholder="Buscar por nombre, correo o teléfono..." class="w-full mb-3 px-3 py-2 border border-gray-300 rounded" autocomplete="off" />
        <div *ngIf="cargando" class="text-center py-4">Cargando...</div>
        <div *ngIf="mensajeError" class="text-red-600 mb-2">{{ mensajeError }}</div>
        <div class="mb-4">
          <h3 class="text-sm font-semibold text-gray-700 mb-1">Chats recientes</h3>
          <div *ngIf="cargandoChatsRecientes" class="text-xs text-gray-400 mb-2">Cargando chats...</div>
          <ul>
            <li *ngFor="let chat of chatsRecientes" (click)="seleccionarChatReciente(chat)"
                [class.bg-cyan-100]="usuarioSeleccionado?.id === chat.usuario.id"
                class="p-2 rounded cursor-pointer hover:bg-cyan-50 mb-1 flex flex-col">
              <span class="font-medium">{{ chat.usuario.nombre }}</span>
              <span class="block text-xs text-gray-500">{{ chat.usuario.correo }}</span>
              <span class="block text-xs text-gray-400 truncate">{{ chat.ultimo_mensaje.contenido }}</span>
              <span class="block text-[10px] text-gray-300">{{ chat.ultimo_mensaje.fecha | date:'short' }}</span>
            </li>
          </ul>
        </div>
        <ul>
          <li *ngFor="let usuario of usuariosFiltrados" (click)="seleccionarUsuario(usuario)"
              [class.bg-purple-100]="usuarioSeleccionado?.id === usuario.id"
              class="p-2 rounded cursor-pointer hover:bg-purple-50 mb-1">
            <span class="font-medium">{{ usuario.primer_nombre }} {{ usuario.primer_apellido }}</span>
            <span class="block text-xs text-gray-500">{{ usuario.correo }}</span>
          </li>
        </ul>
        <div *ngIf="totalPaginas > 1" class="flex justify-center items-center gap-2 mt-2">
          <button (click)="cambiarPagina(-1)" [disabled]="paginaActual === 1" class="px-2 py-1 rounded bg-gray-200 hover:bg-gray-300 disabled:bg-gray-100">Anterior</button>
          <span>Página {{ paginaActual }} de {{ totalPaginas }}</span>
          <button (click)="cambiarPagina(1)" [disabled]="paginaActual === totalPaginas" class="px-2 py-1 rounded bg-gray-200 hover:bg-gray-300 disabled:bg-gray-100">Siguiente</button>
        </div>
      </div>
      <!-- Chat -->
      <div class="bg-white rounded-lg shadow-lg p-4 md:col-span-2 min-h-100">
        <ng-container *ngIf="usuarioSeleccionado; else seleccionaUsuario">
          <app-perfil-usuario [usuario]="usuarioSeleccionado"></app-perfil-usuario>
          <div class="flex justify-end mb-4">
            <button (click)="mostrarChatUsuario()" *ngIf="!mostrarChat" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded shadow">Enviar mensaje</button>
            <button (click)="ocultarChatUsuario()" *ngIf="mostrarChat" class="bg-gray-400 hover:bg-gray-500 text-white px-4 py-2 rounded shadow">Cerrar chat</button>
          </div>
          <app-chat *ngIf="mostrarChat" [userId]="usuarioSeleccionado.id!" userRol="admin" tipoChat="soporte"></app-chat>
        </ng-container>
        <ng-template #seleccionaUsuario>
          <div class="text-gray-500 text-center py-20">Selecciona un usuario para ver el chat de soporte</div>
        </ng-template>
      </div>
    </div>
  </div>
</div>
